---
title: "R Notebook"
output: html_notebook
---
You have been provided some customer data from a shopping centre. Do some exploratory analysis on the data. Comment on findings.
```{r}
library(tidyverse)
mall <- read_csv("data/mall_customers.csv") %>% 
  janitor::clean_names()

head(mall)
```

```{r}
mall %>% ggplot(aes(annual_income_k, spending_score_1_100))+
  geom_point(aes(col = age))

#the graph looks like there are about 5 groups and looks like clustering 
#will be a good method.
```

We are interested in creating a marketing campaign to target customers based on their spending score and annual income. Perform a k-means clustering to find if there are meaningful clusters in the data to target the customers.

Perform k-means clustering and chose a value of k.
```{r}
mall_scale <- mall %>% 
   select(annual_income_k, spending_score_1_100) %>% 
   mutate(across(.fns = scale))
```

```{r}
clustered <- mall_scale %>% 
  kmeans(centers = 6,
         nstart = 25)

clustered

library(broom)
clustered %>% 
  augment(mall %>% select(annual_income_k, spending_score_1_100))
mall_short <- mall %>% select(annual_income_k, spending_score_1_100)
```

```{r}
glance(clustered)

```
```{r}
max_k <- 20
k_clusters <- tibble(k = 1:max_k) %>% 
  mutate(
    kclust = map(k, ~ kmeans(mall_scale, .x, nstart = 25)),
    tidied = map(kclust, tidy),
    glanced = map(kclust, glance),
    augmented = map(kclust, augment, mall_short)
  )

k_clusters
```
```{r}
library(factoextra)
```

```{r}
fviz_nbclust(mall_scale,
             kmeans,
             method = "wss",
             nstart = 25)

fviz_nbclust(mall_scale, 
             kmeans, 
             method = "silhouette", 
             nstart = 25)

fviz_nbclust(mall_scale, 
             kmeans, 
             method = "gap_stat", 
             nstart = 25, 
             k.max = 10)
```


Visualise the clustering for your chosen value of k.
```{r}
k_clusters %>% unnest(glanced) %>% 
  unnest(cols = c(augmented)) %>%
  filter(k == 5) %>%
  ggplot(aes(x=annual_income_k, y=spending_score_1_100)) +
  geom_point(aes(color = .cluster))
```

Do you think the clustering seems a good fit for this data?

```
from the graph, it seems to match what we found eailer and can see clear 
group,Silhouette coefficient is > 0 so it's good. 
```

Comment on the attributes on one or two of the clusters (maybe even give them a label if you like - like in section 4.1 of the ‘Segmentation & clustering intro’ lesson).
```
cluster 5 has lower income and low spending : servivers 
cluster 3 has higher income and low spending : savers 
```

